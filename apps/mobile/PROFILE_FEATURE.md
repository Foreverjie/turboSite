# Mobile App 功能更新

## 新增功能：个人信息页面

### 概述

为移动应用添加了完整的用户认证流程和个人信息页面，包括：

1. **登录页面** - 用户可以使用邮箱和密码登录
2. **个人信息页面** - 显示用户资料、统计信息和操作选项
3. **导航系统** - 登录后可以在不同页面间切换

### 文件结构

```
apps/mobile/src/
├── screens/
│   ├── SignInScreen.tsx    # 登录页面 (已更新)
│   ├── ProfileScreen.tsx   # 个人信息页面 (新增)
│   └── index.ts           # 导出文件 (已更新)
├── components/
│   └── AppNavigator.tsx   # 应用导航器 (已更新)
```

### 功能详情

#### 1. 登录页面更新 (`SignInScreen.tsx`)

- 添加了 `onSignInSuccess` 回调属性
- 登录成功后自动跳转到个人信息页面
- 使用 tRPC `user.signIn` mutation 进行用户认证

```tsx
interface SignInScreenProps {
  onSignInSuccess?: () => void
}
```

#### 2. 个人信息页面 (`ProfileScreen.tsx`)

**主要功能：**
- 显示用户头像（使用邮箱首字母）
- 显示用户名（从邮箱提取）和邮箱地址
- 显示用户统计信息（文章数、关注者、关注中）
- 显示用户基本信息（ID、注册时间、个人简介）
- 提供设置和退出登录操作

**使用的 tRPC endpoints：**
- `trpc.user.me.useQuery()` - 获取当前用户信息
- `trpc.post.all.useQuery({ limit: 10 })` - 获取用户文章列表

**界面元素：**
- 头像区域：圆形头像 + 用户名 + 邮箱 + 编辑按钮
- 统计卡片：文章数、关注者数、关注中数
- 信息列表：用户ID、注册时间、个人简介
- 操作按钮：设置、退出登录

#### 3. 应用导航器更新 (`AppNavigator.tsx`)

**状态管理：**
- `isAuthenticated` - 用户登录状态
- `currentScreen` - 当前显示的页面

**导航功能：**
- 未登录时显示登录页面
- 登录后显示个人信息页面和设置页面
- 顶部标签栏用于页面切换
- 支持退出登录功能

**页面切换：**
```tsx
type Screen = 'profile' | 'settings'
```

### 样式设计

使用统一的 design tokens：
- 颜色：`colors.primary`, `colors.gray`, `colors.error`
- 间距：`spacing.xs` 到 `spacing['3xl']`
- 字体：`fontSize.xs` 到 `fontSize['2xl']`
- 统一的圆角、阴影等视觉元素

### 用户体验流程

1. **初始状态**：用户看到登录页面
2. **登录过程**：
   - 用户输入邮箱和密码
   - 点击登录按钮
   - tRPC 发送认证请求
   - 成功后显示成功提示
3. **登录成功**：自动跳转到个人信息页面
4. **个人信息页面**：
   - 显示用户基本信息
   - 显示统计数据
   - 提供操作选项
5. **页面导航**：可以通过顶部标签栏切换页面
6. **退出登录**：点击退出按钮，确认后返回登录页面

### 错误处理

- **网络错误**：显示错误信息和重试选项
- **认证失败**：显示失败原因
- **数据加载失败**：显示友好的错误提示
- **用户确认**：退出登录前显示确认对话框

### 下一步计划

- [ ] 添加用户注册功能
- [ ] 添加忘记密码功能
- [ ] 实现编辑资料功能
- [ ] 添加设置页面内容
- [ ] 实现推送通知设置
- [ ] 添加主题切换功能
- [ ] 实现离线缓存
- [ ] 添加头像上传功能

### 技术特点

1. **类型安全**：使用 TypeScript 和 tRPC 确保端到端类型安全
2. **状态管理**：使用 React Query 管理服务器状态
3. **错误处理**：统一的错误处理和用户反馈
4. **响应式设计**：适配不同屏幕尺寸
5. **性能优化**：使用 React Query 的缓存机制
6. **用户体验**：加载状态、错误状态、空状态的完整处理

### API 依赖

确保后端提供以下 tRPC endpoints：
- `user.signIn` - 用户登录
- `user.me` - 获取当前用户信息
- `post.all` - 获取文章列表

### 运行说明

1. 确保后端服务器运行在正确的端口
2. 确保 tRPC 配置正确
3. 启动移动应用：`pnpm dev`
4. 使用有效的用户凭据进行测试

这个更新为移动应用提供了完整的用户认证和个人信息管理功能，为后续功能开发奠定了基础。
